blueprint:
  name: ğŸ’¡ Podbitka + Podjazd â€“ Automatyczne Å›wiatÅ‚a (Brama + Drzwi)
  description: >
    Kompleksowa automatyzacja oÅ›wietlenia zewnÄ™trznego:
    - Podbitka wÅ‚Ä…cza siÄ™ po zmierzchu i wyÅ‚Ä…cza o 22:00 etapami
    - Rano o 6:00 wÅ‚Ä…cza siÄ™, jeÅ›li nadal ciemno
    - WyÅ‚Ä…cza siÄ™ przy peÅ‚nym dniu
    - Osobne Å›wiatÅ‚a i czas Å›wiecenia po otwarciu bramy lub drzwi
    - Licznik czasu resetuje siÄ™ przy ponownym otwarciu bramy lub drzwi
    - Pomija dziaÅ‚anie, gdy input_boolean.swieta = ON

  domain: automation
  source_url: "https://raw.githubusercontent.com/GieOeRZet/akwarium/main/blueprints/automation/gieoerzet/swiatla_zewnetrzne.yaml"

  input:
    podbitka_all:
      name: ğŸ’¡ ÅšwiatÅ‚a podbitki â€“ caÅ‚oÅ›Ä‡
      selector:
        entity:
          domain: light

    podbitka_srodki:
      name: ğŸ’¡ ÅšwiatÅ‚a â€“ Å›rodki
      selector:
        entity:
          domain: light

    podbitka_rogi:
      name: ğŸ’¡ ÅšwiatÅ‚a â€“ rogi
      selector:
        entity:
          domain: light

    czujnik_drzwi:
      name: ğŸšª Czujnik drzwi wejÅ›ciowych
      selector:
        entity:
          domain: binary_sensor

    brama:
      name: ğŸš§ Brama wjazdowa
      selector:
        entity:
          domain: cover

    czujnik_dnia:
      name: ğŸŒ… Sensor okresu dnia
      selector:
        entity:
          domain: sensor

    swieta:
      name: ğŸ„ PrzeÅ‚Ä…cznik â€ÅšwiÄ™taâ€
      selector:
        entity:
          domain: input_boolean

    godzina_off:
      name: ğŸ•™ Godzina wyÅ‚Ä…czenia wieczorem
      default: "22:00:00"
      selector:
        time: {}

    godzina_rano:
      name: ğŸŒ… Godzina wÅ‚Ä…czenia rano
      default: "06:00:00"
      selector:
        time: {}

    # --- NOWE INPUTY ---
    swiatla_bramy:
      name: ğŸ’¡ ÅšwiatÅ‚a zapalane po otwarciu bramy
      description: Wybierz, ktÃ³re Å›wiatÅ‚a majÄ… siÄ™ wÅ‚Ä…czaÄ‡ przy otwieraniu bramy.
      selector:
        target:
          entity:
            domain: light

    swiatla_drzwi:
      name: ğŸ’¡ ÅšwiatÅ‚a zapalane po otwarciu drzwi
      description: Wybierz, ktÃ³re Å›wiatÅ‚a majÄ… siÄ™ wÅ‚Ä…czaÄ‡ przy otwarciu drzwi wejÅ›ciowych.
      selector:
        target:
          entity:
            domain: light

    czas_bramy:
      name: â±ï¸ Czas Å›wiecenia po otwarciu bramy (min)
      default: 5
      selector:
        number:
          min: 1
          max: 30
          unit_of_measurement: min
          mode: slider

    czas_drzwi:
      name: â±ï¸ Czas Å›wiecenia po otwarciu drzwi (min)
      default: 5
      selector:
        number:
          min: 1
          max: 30
          unit_of_measurement: min
          mode: slider

mode: restart

triggers:
  - platform: state
    entity_id: !input czujnik_dnia
    from: daylight
    id: PodbitkaON

  - platform: state
    entity_id: !input czujnik_dnia
    to: daylight
    id: PodbitkaDaylightOFF

  - platform: time
    at: !input godzina_off
    id: PodbitkaOFF

  - platform: time
    at: !input godzina_rano
    id: PodbitkaRANO

  - platform: state
    entity_id: !input brama
    to: opening
    id: BramaOPEN

  - platform: state
    entity_id: !input czujnik_drzwi
    to: "on"
    id: DrzwiOPEN

conditions:
  - condition: state
    entity_id: !input swieta
    state: "off"

actions:
  - choose:
      # ---- WIECZOREM po zmierzchu ----
      - conditions:
          - condition: trigger
            id: PodbitkaON
        sequence:
          - service: light.turn_on
            target:
              entity_id: !input podbitka_all

      # ---- O 22:00 â€“ wyÅ‚Ä…czenie etapowe ----
      - conditions:
          - condition: trigger
            id: PodbitkaOFF
        sequence:
          - service: light.turn_off
            target:
              entity_id: !input podbitka_srodki
          - delay: "00:30:00"
          - service: light.turn_off
            target:
              entity_id: !input podbitka_rogi

      # ---- RANO o 6:00 (jeÅ›li ciemno) ----
      - conditions:
          - condition: trigger
            id: PodbitkaRANO
          - condition: or
            conditions:
              - condition: state
                entity_id: !input czujnik_dnia
                state: nightlight
              - condition: state
                entity_id: !input czujnik_dnia
                state: dawnlight
        sequence:
          - service: light.turn_on
            target:
              entity_id: !input podbitka_all

      # ---- WYÅÄ„CZ przy peÅ‚nym dniu ----
      - conditions:
          - condition: trigger
            id: PodbitkaDaylightOFF
        sequence:
          - service: light.turn_off
            target:
              entity_id: !input podbitka_all

      # ---- OTWARCIE BRAMY (nocÄ…) ----
      - conditions:
          - condition: trigger
            id: BramaOPEN
          - condition: or
            conditions:
              - condition: state
                entity_id: !input czujnik_dnia
                state: nightlight
              - condition: state
                entity_id: !input czujnik_dnia
                state: dawnlight
              - condition: state
                entity_id: !input czujnik_dnia
                state: dusklight
        sequence:
          - service: light.turn_on
            target: !input swiatla_bramy
          - delay:
              minutes: !input czas_bramy
          - service: light.turn_off
            target: !input swiatla_bramy

      # ---- OTWARCIE DRZWI (nocÄ…) ----
      - conditions:
          - condition: trigger
            id: DrzwiOPEN
          - condition: or
            conditions:
              - condition: state
                entity_id: !input czujnik_dnia
                state: nightlight
              - condition: state
                entity_id: !input czujnik_dnia
                state: dawnlight
              - condition: state
                entity_id: !input czujnik_dnia
                state: dusklight
        sequence:
          - service: light.turn_on
            target: !input swiatla_drzwi
          - delay:
              minutes: !input czas_drzwi
          - service: light.turn_off
            target: !input swiatla_drzwi
