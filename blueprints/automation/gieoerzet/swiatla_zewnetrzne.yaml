blueprint:
  name: üí° Podbitka + Podjazd ‚Äì Automatyczne ≈õwiat≈Ça (Brama + Drzwi)
  description: >
    Kompleksowa automatyzacja o≈õwietlenia zewnƒôtrznego:
    - Podbitka w≈ÇƒÖcza siƒô po zmierzchu i wy≈ÇƒÖcza o 22:00 etapami
    - Rano o 6:00 w≈ÇƒÖcza siƒô, je≈õli nadal ciemno
    - Wy≈ÇƒÖcza siƒô przy pe≈Çnym dniu
    - Osobne ≈õwiat≈Ça i czas ≈õwiecenia po otwarciu bramy lub drzwi
    - Licznik czasu resetuje siƒô przy ponownym otwarciu bramy lub drzwi
    - Pomija dzia≈Çanie, gdy input_boolean.swieta = ON

  domain: automation
  source_url: "https://raw.githubusercontent.com/GieOeRZet/akwarium/main/blueprints/automation/gieoerzet/swiatla_zewnetrzne.yaml"

  input:
    podbitka_all:
      name: üí° ≈öwiat≈Ça podbitki ‚Äì ca≈Ço≈õƒá
      description: G≈Ç√≥wna grupa lub ≈õwiat≈Ça do w≈ÇƒÖczania/wy≈ÇƒÖczania ca≈Ço≈õci.
      selector:
        entity:
          domain: light

    podbitka_srodki:
      name: üí° ≈öwiat≈Ça ‚Äì ≈õrodki
      description: ≈öwiat≈Ça ≈õrodkowe do wy≈ÇƒÖczenia o 22:00.
      selector:
        entity:
          domain: light

    podbitka_rogi:
      name: üí° ≈öwiat≈Ça ‚Äì rogi
      description: ≈öwiat≈Ça rogowe do wy≈ÇƒÖczenia 30 minut po 22:00.
      selector:
        entity:
          domain: light

    podjazd_swiatlo:
      name: üöó ≈öwiat≈Ço podjazdu
      description: O≈õwietlenie podjazdu lub ≈õcie≈ºki ‚Äì mo≈ºe byƒá u≈ºyte przy bramie lub drzwiach.
      selector:
        entity:
          domain: light

    czujnik_drzwi:
      name: üö™ Czujnik drzwi wej≈õciowych
      description: Sensor otwarcia drzwi wej≈õciowych (binary_sensor).
      selector:
        entity:
          domain: binary_sensor

    brama:
      name: üöß Brama wjazdowa
      description: Encja bramy (cover), kt√≥ra uruchamia ≈õwiat≈Ça po otwarciu.
      selector:
        entity:
          domain: cover

    czujnik_dnia:
      name: üåÖ Sensor okresu dnia
      description: Sensor np. sensor.period_of_day z warto≈õciami daylight / nightlight / dawnlight / dusklight.
      selector:
        entity:
          domain: sensor

    swieta:
      name: üéÑ Prze≈ÇƒÖcznik ‚Äû≈öwiƒôta‚Äù
      description: Nie uruchamiaj automatyzacji, je≈õli w≈ÇƒÖczony.
      selector:
        entity:
          domain: input_boolean

    godzina_off:
      name: üïô Godzina wy≈ÇƒÖczenia wieczorem
      default: "22:00:00"
      selector:
        time: {}

    godzina_rano:
      name: üåÖ Godzina w≈ÇƒÖczenia rano
      default: "06:00:00"
      selector:
        time: {}

    # --- NOWE INPUTY (z podpowiedziami) ---
    swiatla_bramy:
      name: üí° ≈öwiat≈Ça zapalane po otwarciu bramy
      description: >
        Wybierz spo≈õr√≥d wcze≈õniej dodanych ≈õwiate≈Ç (np. podbitka, podjazd),
        kt√≥re majƒÖ siƒô zapalaƒá przy otwieraniu bramy.
      default: !input podbitka_all
      selector:
        target:
          entity:
            domain: light

    swiatla_drzwi:
      name: üí° ≈öwiat≈Ça zapalane po otwarciu drzwi
      description: >
        Wybierz spo≈õr√≥d wcze≈õniej dodanych ≈õwiate≈Ç (np. podjazd),
        kt√≥re majƒÖ siƒô zapalaƒá przy otwieraniu drzwi wej≈õciowych.
      default: !input podjazd_swiatlo
      selector:
        target:
          entity:
            domain: light

    czas_bramy:
      name: ‚è±Ô∏è Czas ≈õwiecenia po otwarciu bramy (min)
      description: Po ilu minutach wy≈ÇƒÖczyƒá ≈õwiat≈Ça zapalone przez bramƒô.
      default: 5
      selector:
        number:
          min: 1
          max: 30
          unit_of_measurement: min
          mode: slider

    czas_drzwi:
      name: ‚è±Ô∏è Czas ≈õwiecenia po otwarciu drzwi (min)
      description: Po ilu minutach wy≈ÇƒÖczyƒá ≈õwiat≈Ça zapalone przez drzwi.
      default: 5
      selector:
        number:
          min: 1
          max: 30
          unit_of_measurement: min
          mode: slider

mode: restart

triggers:
  - platform: state
    entity_id: !input czujnik_dnia
    from: daylight
    id: PodbitkaON

  - platform: state
    entity_id: !input czujnik_dnia
    to: daylight
    id: PodbitkaDaylightOFF

  - platform: time
    at: !input godzina_off
    id: PodbitkaOFF

  - platform: time
    at: !input godzina_rano
    id: PodbitkaRANO

  - platform: state
    entity_id: !input brama
    to: opening
    id: BramaOPEN

  - platform: state
    entity_id: !input czujnik_drzwi
    to: "on"
    id: DrzwiOPEN

conditions:
  - condition: state
    entity_id: !input swieta
    state: "off"

actions:
  - choose:
      # ---- WIECZOREM po zmierzchu ----
      - conditions:
          - condition: trigger
            id: PodbitkaON
        sequence:
          - service: light.turn_on
            target:
              entity_id: !input podbitka_all

      # ---- O 22:00 ‚Äì wy≈ÇƒÖczenie etapowe ----
      - conditions:
          - condition: trigger
            id: PodbitkaOFF
        sequence:
          - service: light.turn_off
            target:
              entity_id: !input podbitka_srodki
          - delay: "00:30:00"
          - service: light.turn_off
            target:
              entity_id: !input podbitka_rogi

      # ---- RANO o 6:00 (je≈õli ciemno) ----
      - conditions:
          - condition: trigger
            id: PodbitkaRANO
          - condition: or
            conditions:
              - condition: state
                entity_id: !input czujnik_dnia
                state: nightlight
              - condition: state
                entity_id: !input czujnik_dnia
                state: dawnlight
        sequence:
          - service: light.turn_on
            target:
              entity_id: !input podbitka_all

      # ---- WY≈ÅƒÑCZ przy pe≈Çnym dniu ----
      - conditions:
          - condition: trigger
            id: PodbitkaDaylightOFF
        sequence:
          - service: light.turn_off
            target:
              entity_id: !input podbitka_all

      # ---- OTWARCIE BRAMY (nocƒÖ) ----
      - conditions:
          - condition: trigger
            id: BramaOPEN
          - condition: or
            conditions:
              - condition: state
                entity_id: !input czujnik_dnia
                state: nightlight
              - condition: state
                entity_id: !input czujnik_dnia
                state: dawnlight
              - condition: state
                entity_id: !input czujnik_dnia
                state: dusklight
        sequence:
          - service: light.turn_on
            target: !input swiatla_bramy
          - delay:
              minutes: !input czas_bramy
          - service: light.turn_off
            target: !input swiatla_bramy

      # ---- OTWARCIE DRZWI (nocƒÖ) ----
      - conditions:
          - condition: trigger
            id: DrzwiOPEN
          - condition: or
            conditions:
              - condition: state
                entity_id: !input czujnik_dnia
                state: nightlight
              - condition: state
                entity_id: !input czujnik_dnia
                state: dawnlight
              - condition: state
                entity_id: !input czujnik_dnia
                state: dusklight
        sequence:
          - service: light.turn_on
            target: !input swiatla_drzwi
          - delay:
              minutes: !input czas_drzwi
          - service: light.turn_off
            target: !input swiatla_drzwi
